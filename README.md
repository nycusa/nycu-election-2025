# 國立陽明交通大學學生會 選舉投票系統 (2025)

這是一個專為國立陽明交通大學學生會選舉設計的線上匿名投票系統。系統完全基於 Google Workspace 生態系（Apps Script, Google Sheets）打造，旨在提供一個安全、可靠、具匿名性且可被稽核的投票解決方案。

開發者：秀吉的肝

---

## ✨ 核心功能

* **安全認證：** 採用「魔法連結 (Magic Link)」認證機制。使用者輸入學校信箱後，系統會發送一封包含一次性、有時效性的專屬投票連結的郵件，確保只有本人能投票。
* **完整匿名性：** 系統架構將「投票者身份」與「選票內容」在兩個獨立的資料庫中分離儲存。後端透過不可逆的哈希運算對投票者 ID 進行加密，確保即使是系統管理員也無法回溯單張選票的投票人。
* **一人一票完整性：** 後端會即時驗證投票連結的有效性，並在投票完成後立刻將其作廢，從根本上杜絕重複投票。
* **客製化投票介面：** 提供專業、美觀且資訊完整的投票頁面，完整呈現候選人資料與政見，並引導使用者完成投票。
* **自動化流程：** 從請求投票連結、寄送郵件、驗證身份到計票，整個流程高度自動化，減少人為操作失誤。
* **可稽核與視覺化：** 投票結果可輕易地透過外部程式（如 Google Colab）進行最終計票與數據視覺化，產生官方報告。

## 🛠️ 系統架構

本系統採用「純 Google Apps Script 網頁應用程式」架構，所有元件皆在 Google 生態系內運作，無需額外伺服器。

* **前端 (Frontend):** 由 `login.html` 和 `vote.html` 組成，提供使用者互動介面。由 Apps Script 直接提供服務。
* **後端 (Backend):** 由 `Code.gs` 檔案實現，作為系統的總控制中心。它是一個部署為「網頁應用程式」的 API，負責：
    1. 提供前端 HTML 頁面。
    2. 處理前端發來的請求（請求連結、提交選票）。
    3. 驗證投票者資格與投票連結的有效性。
    4. 與 Google Sheets 資料庫進行互動。
    5. 透過 `MailApp` 服務寄送郵件。
* **資料庫 (Database):** 由兩個獨立的 Google Sheets 構成：
    1. **`[資料庫] 選民與驗證碼`**: 儲存所有具備投票資格的使用者名單、信箱、投票狀態及一次性的登入權杖。
    2. **`[票箱] 匿名投票結果`**: 儲存經過哈希匿名化處理後的投票紀錄。

## 🚀 部署指南

請嚴格依照以下步驟，即可從零開始部署一套完整的投票系統。

### 1. 準備資料庫

首先，我們需要建立兩個 Google Sheet 作為資料庫。

#### 1.1 建立 `[資料庫] 選民與驗證碼`

1. 建立一個新的 Google Sheet。
2. 從瀏覽器網址列複製其 **Sheet ID** (位於 `.../d/` 和 `/edit` 之間)。
3. **清空此試算表**，確保其完全空白。
4. 使用提供的 **Colab 腳本**處理您的原始選民名單 CSV 檔，它會生成一個欄位順序正確的 CSV 檔案。
5. 將生成的 CSV 檔案的**所有內容（包含標題列）**，完整複製並貼到這個空白試算表的 `A1` 儲存格。
6. 最終請確認第一列的欄位順序為：`student_id`, `email`, `status`, `vote_timestamp`, `login_token`, `token_expiry`。

#### 1.2 建立 `[票箱] 匿名投票結果`

1. 建立另一個新的、空白的 Google Sheet。
2. 從網址列複製其 **Sheet ID**。
3. 在第一列，依序填入以下標題：`Hashed_ID`, `Candidate_Vote`, `Timestamp`。

### 2. 設定 Google Apps Script 專案

1. 在 Google Drive 中建立一個新的 Apps Script 專案。
2. 在專案中，除了預設的 `Code.gs`，再建立 `login.html` 和 `vote.html` 兩個 HTML 檔案。
3. 將最終確認可行的**三個檔案的完整程式碼**，分別複製並貼上到對應的檔案中。
4. 打開 `Code.gs`，找到最上方的「設定區」，將您剛剛取得的兩個 **Sheet ID** 填入對應的變數中。
5. 點擊 💾 圖示**儲存專案**。

### 3. 部署網頁應用程式

1. 在 Apps Script 編輯器中，點擊右上角的藍色**「部署」**按鈕。
2. 選擇**「新增部署作業」**。
3. 點擊「選取類型」旁的 ⚙ 圖示，選擇**「網頁應用程式」**。
4. 進行以下設定：
    * **執行身份：** `我`
    * **誰可以存取：** `任何人`
5. 點擊**「部署」**。
6. 在跳出的視窗中，完成**授權存取**的流程（可能需要點擊「進階」並允許不安全的應用程式）。
7. 完成後，您會得到一個以 `/exec` 結尾的網址。**這個網址就是您最終的官方投票系統入口。**

## 📊 選後計票

選舉結束後，可使用 Google Colab 腳本，連接到 `[票箱]` 試算表，自動進行計票、分析與視覺化圖表的生成，以產出最終的官方報告。

## 📄 授權

本專案採用 [MIT License](https://opensource.org/licenses/MIT)。
